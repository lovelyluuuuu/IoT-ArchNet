# 数据库设计说明文档

---

## 1. 概述
本设计文档描述了多机器人协作系统的完整数据库结构，包含用户管理、权限控制、机器人管理、任务管理、状态上报等功能模块。并详细说明了各表的结构及其关系。

---

## 2. 数据表清单

| **表名**                 | **描述**                                                |
|--------------------------|--------------------------------------------------------|
| `users`                 | 管理系统用户的基本信息和认证信息。                        |
| `user_logs`             | 记录用户的操作行为日志。                                  |
| `user_sessions`         | 管理用户的会话信息，用于登录认证。                        |
| `user_robot_permissions`| 管理用户对机器人资源的权限。                              |
| `robots`                | 存储机器人的基础信息。                                    |
| `tasks`                 | 存储与机器人相关的任务。                                  |
| `status_reports`        | 存储机器人实时状态数据。                                  |
| `robot_trajectories`    | 记录机器人运行的轨迹数据。                                |
| `alerts`                | 存储机器人或系统的报警信息。                              |
| `path_plans`            | 存储路径规划信息，包括起点、终点和中转站。                 |
| `restricted_areas`      | 存储危险区域的边界坐标及多边形数据。                       |

---

## 3. 数据表详细设计

### 3.1. 用户相关表

#### 3.1.1. `users` 表
- **功能**：存储用户的基本信息和角色。
- **主要字段**：
  - `user_id`：用户唯一标识符（主键）。
  - `username`：用户名（唯一）。
  - `password_hash`：加密后的密码。
  - `role`：用户角色（如管理员、操作员）。
  - `status`：用户状态（激活、禁用、封禁）。

#### 3.1.2. `user_logs` 表
- **功能**：记录用户的操作行为。
- **主要字段**：
  - `action`：用户的具体操作（如 "创建任务"）。
  - `target_id`：操作目标 ID（如机器人或任务）。
  - `target_type`：操作目标的类型（机器人、任务等）。

#### 3.1.3. `user_sessions` 表
- **功能**：存储用户的登录会话，用于维护登录状态。
- **主要字段**：
  - `session_id`：会话唯一标识。
  - `ip_address`：用户登录的 IP 地址。
  - `expires_at`：会话过期时间。

#### 3.1.4. `user_robot_permissions` 表
- **功能**：管理用户对机器人资源的权限。
- **主要字段**：
  - `user_id`：用户 ID（外键）。
  - `robot_id`：机器人 ID（外键）。
  - `permission_level`：权限级别（读、写）。

---

### 3.2. 机器人相关表

#### 3.2.1. `robots` 表
- **功能**：存储机器人基础信息。
- **主要字段**：
  - `robot_id`：机器人唯一标识符。
  - `status`：机器人状态（离线、在线、故障）。

#### 3.2.2. `status_reports` 表
- **功能**：存储机器人上报的状态数据。
- **主要字段**：
  - `battery_energy`：电量百分比。
  - `x_coord`、`y_coord`：位置信息（冗余字段）。

#### 3.2.3. `robot_trajectories` 表
- **功能**：存储机器人轨迹点。
- **主要字段**：
  - `x_coord`、`y_coord`、`latitude` 等位置信息。

#### 3.2.4. `alerts` 表
- **功能**：存储机器人触发的报警数据。
- **主要字段**：
  - `alert_type`：报警类型（低电量、故障等）。
  - `severity`：报警严重级别。

---

### 3.3. 任务相关表

#### 3.3.1. `tasks` 表
- **功能**：存储任务信息。
- **主要字段**：
  - `created_by`：任务的创建者（用户 ID 外键）。
  - `robot_id`：任务关联的机器人。

#### 3.3.2. `path_plans` 表
- **功能**：存储路径规划信息。
- **主要字段**：
  - `start_x`、`start_y`：起点坐标。
  - `end_x`、`end_y`：终点坐标。

#### 3.3.3. `restricted_areas` 表
- **功能**：存储危险区域。
- **主要字段**：
  - `x_min`、`x_max`、`y_min`、`y_max`：区域范围边界。

---

## 4. 数据表关系

### 用户与机器人
- 用户通过 `user_robot_permissions` 表管理对机器人的权限。
- 用户与机器人的操作日志存储在 `user_logs` 表中。

### 用户与任务
- 用户在 `tasks` 表中创建任务，任务的创建者存储在 `created_by` 字段中。

### 机器人与状态/轨迹
- 机器人上报状态存储在 `status_reports` 表。
- 机器人轨迹点存储在 `robot_trajectories` 表。

---

## 5. 数据流设计

### 用户操作
1. 用户登录时，创建会话记录到 `user_sessions` 表。
2. 用户执行操作时，记录日志到 `user_logs` 表。
3. 用户通过权限表管理对机器人的访问。

### 状态上报
1. 机器人定期上报状态数据。
2. 数据解析后，存储到 `status_reports` 表，常用字段冗余存储为独立列。

### 路径规划
1. 后端生成路径规划，并存储到 `path_plans` 表。
2. 规划完成后分发给指定机器人。

---


